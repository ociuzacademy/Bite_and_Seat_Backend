{% extends "adminapp/dashboard.html" %}

{% block content %}

<style>
    :root {
        --primary: #00477d;
        --danger: #d9534f;
        --light: #e6f0ff;
    }

    .page-title {
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 25px;
    }

    .user-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #e3f2f2;
    }

    table {
        border-radius: 12px !important;
        overflow: hidden;
    }

    thead {
        background: var(--light);
    }

    thead th {
        font-weight: 600;
        color: #00477d;
    }

    tbody tr:hover {
        background: #f7fcfc;
    }

    .btn-edit,
    .btn-delete {
        border-radius: 6px;
        padding: 6px 14px;
        font-size: 14px;
    }

    .btn-edit {
        background: var(--primary);
        color: #fff;
    }

    .btn-edit:hover {
        background: #055b5b;
    }

    .btn-delete {
        background: var(--danger);
        color: #fff;
    }

    .btn-delete:hover {
        background: #b64541;
    }

    .profile-img {
        height: 50px;
        width: 50px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ccc;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
</style>

<div class="container mt-4 d-flex justify-content-center">

    <div class="col-lg-10">

        <div class="user-card">

            <h2 class="page-title text-center mb-4">All Users</h2>
                <div class="status-filter mb-3">
                    <form method="get" class="d-flex align-items-center">
                        <label class="me-2">Filter by Status:</label>
                        <select name="status" class="form-select w-auto me-2" onchange="this.form.submit()">
                            <option value="all" {% if current_status == 'all' %}selected{% endif %}>All Users</option>
                            <option value="pending" {% if current_status == 'pending' %}selected{% endif %}>Pending</option>
                            <option value="approved" {% if current_status == 'approved' %}selected{% endif %}>Approved</option>
                            <option value="rejected" {% if current_status == 'rejected' %}selected{% endif %}>Rejected</option>
                        </select>
                        <a href="{% url 'admin_view_users' %}" class="btn btn-secondary btn-sm">Clear Filter</a>
                    </form>
                </div>

            {% for message in messages %}
            <div class="alert alert-success text-center">{{ message }}</div>
            {% endfor %}

                <div style="margin-bottom: 20px;">
                    <a href="{% url 'admin_dashboard' %}" 
                       style="background-color: #00477d; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px; display: inline-block; margin-left: 10px;">
                        ‚Üê Back to Dashboard
                    </a>
                    <a href="{% url 'admin_pending_users' %}" 
                       style="background-color: #00477d; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px; display: inline-block;">
                         View Pending Registrations
                    </a>
                </div>
        
            <div class="table-responsive">
                <table class="table table-bordered align-middle text-center">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Profile</th>
                            <th>Username</th>
                            <th>User Type</th>
                            <th>Department</th>
                            <th>Batch</th>
                            <th>Registration Status</th>
                            <th>Actions</th>                            
                        </tr>
                    </thead>

                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td>{{ forloop.counter }}</td>

                            <td>
                                {% if user.profile_photo %}
                                <img src="/media/{{ user.profile_photo }}" class="profile-img">
                                {% else %}
                                <img src="https://via.placeholder.com/50" class="profile-img">
                                {% endif %}
                            </td>

                            <td>{{ user.username }}</td>
                            <td>{{ user.get_user_type_display }}</td>
                            <td>{{ user.department }}</td>

                            <td>
                                {% if user.user_type == 'student' %}
                                {{ user.batch_name }}
                                {% else %}
                                -
                                {% endif %}
                            </td>

                            <td>
                                <span class="badge 
                                    {% if user.registration_status == 'approved' %}bg-success
                                    {% elif user.registration_status == 'rejected' %}bg-danger
                                    {% else %}bg-warning{% endif %}">
                                    {{ user.registration_status|title }}
                                </span>
                            </td>
                            
                            <td>
                                <a href="{% url 'admin_edit_user' user.id %}" class="btn btn-edit btn-sm">
                                    Edit
                                </a>

                                <a href="{% url 'admin_delete_user' user.id %}" 
                                   class="btn btn-delete btn-sm"
                                   onclick="return confirm('Are you sure you want to delete this user?');">
                                    Delete
                                </a>
                            </td>

                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>

        </div>

    </div>
</div>

{% endblock %}
